import api.gigachat_api

class GeneratePrompt:
    async def generate_prompt_for_image(user_request: str, nko_information: str, giga: api.gigachat_api.GigaChatAPI) -> str:
        # Формируем системный промпт в зависимости от наличия информации об НКО
        base_system_prompt = """
        Ты профессиональный ассистент для создания детализированных промптов для генерации изображений. 
        Твоя задача - преобразовать короткий запрос пользователя в подробное, художественное описание на английском языке.

        Правила преобразования:
        1. Добавь конкретные детали: стиль (фотография, цифровое искусство, картина маслом и т.д.)
        2. Укажи освещение (естественное, студийное, драматическое и т.д.)
        3. Опиши композицию (крупный план, общий план, ракурс)
        4. Добавь детали о цветовой палитре и текстурах
        5. Укажи настроение и атмосферу
        6. Если уместно - добавь контекст окружения
        7. Не указывай никаких комментариев по типу "Вот уточнённый и подходящий промпт" и "Такой подход помогает подчеркнуть идеалы НКО.". Только готовый промпт.
        8. Итоговый ответ на АНГЛИЙСКОМ языке

        """
        user_message = f"""
        {base_system_prompt}
        Исходный запрос пользователя: {user_request}
    
        Создай улучшенный промпт для генерации изображения.
        В твоем ответе должно быть не более 600 символов!
        """
    
        # Используем GigaChatAPI для генерации промпта
        enhanced_prompt = await giga.generate_text(
            request=user_message
        )
    
        return enhanced_prompt.strip()
    
    async def generate_nko_description(short_nko_description: str, giga: api.gigachat_api.GigaChatAPI) -> str:
        """
        Создает подробное описание НКО на основе краткого описания.
    
        Args:
            short_nko_description: Краткое описание НКО
            giga: API для работы с GigaChat
        
        Returns:
            str: Подробное описание НКО на русском языке
        """
    
        system_prompt = """
        Ты профессиональный ассистент для создания подробных описаний некоммерческих организаций (НКО).
        Твоя задача - расширить краткое описание НКО в развернутое, информативное описание на русском языке.

        Правила создания описания:
        1. Опиши основные цели и миссию организации
        
        2. Укажи возможные направления деятельности (если применимо)
        3. Опиши целевую аудиторию или благополучателей
        4. Добавь информацию о ценностях и принципах работы
        5. Укажи возможную социальную значимость

        ВАЖНЫЕ ОГРАНИЧЕНИЯ:
        - НЕ придумывай конкретные факты, цифры, названия проектов
        - НЕ добавляй информацию, которой нет в исходном описании
        - Используй только общие формулировки, вытекающие из краткого описания
        - Описание должно быть реалистичным и соответствовать типу организации

        Примеры преобразования:
        Краткое описание: "Экологическая организация по защите океанов"
        Результат: "Экологическая некоммерческая организация, специализирующаяся на защите морских экосистем и океанических вод. Основные направления деятельности включают сохранение биоразнообразия океанов, борьбу с загрязнением водных ресурсов, защиту морских животных. Организация ориентирована на просвещение общества о важности сохранения океанической среды и привлечение внимания к экологическим проблемам морских пространств."

        Краткое описание: "Фонд помощи детям с онкологическими заболеваниями"
        Результат: "Благотворительный фонд, оказывающий поддержку детям с онкологическими заболеваниями и их семьям. Основная деятельность направлена на организацию медицинской помощи, психологическую поддержку пациентов и родственников, приобретение необходимых медикаментов и оборудования. Фонд стремится улучшить качество жизни детей в процессе лечения и способствовать их успешной реабилитации."

        Требования к ответу:
        - Отвечай ТОЛЬКО развернутым описанием на русском языке
        - Не добавляй пояснения или комментарии
        - Описание должно быть 3-5 предложений
        - Сохраняй официально-деловой стиль
        - Не используй маркеры списков
        """

        user_message = f"""
        Краткое описание НКО: {short_nko_description}
    
        Создай развернутое описание этой некоммерческой организации:
        """
    
        # Используем GigaChatAPI для генерации описания
        detailed_description = await giga.generate_text(
            request=user_message
        )
    
        return detailed_description.strip()

    async def generate_post_prompt( user_text: str, style: str, nko_information: str) -> str:
        # Базовый промпт с учетом стиля и НКО
        base_context = f"Стиль изложения: {style}."
        if nko_information and nko_information != "None":
            base_context += f" Учитывай контекст некоммерческой организации: {nko_information}"
        content_type_instructions = """
Создай качественный пост для социальных сетей со следующей структурой:
- Основной текст с полезной информацией
- Призыв к действию или вопрос для вовлечения аудитории
- 3-5 релевантных хэштегов в конце
Требования:
- Текст должен быть живым и engaging
- Используй эмодзи где это уместно
- Абзацы не более 2-3 строк
- общий текст не более 200 слов
- Хэштеги должны быть релевантными тематике
- чем это полезно городу и людям
"""
        result = f"""
{base_context}
    
{content_type_instructions}
    
Запрос пользователя: {user_text}
    
Дополнительные требования:
- Отвечай на русском языке
- Используй структурированный подход
"""    
        return result
    async def generate_copy_of_post_prompt( user_text: str, style: str, nko_information: str) -> str:
        # Базовый промпт с учетом стиля и НКО
        base_context = f"Стиль изложения: {style}."
        if nko_information and nko_information != "None":
            base_context += f" Учитывай контекст некоммерческой организации: {nko_information}"
        content_type_instructions = """
Ты — профессиональный редактор. Твоя задача — создать ревизию текста, которая точечно интегрирует правки пользователя, являясь его полным аналогом по структуре, объему и стилистике.
Ты получишь запрос в одной строке. Сначала в этой строке будет идти исходный текст. Твоя задача - воспроизвести исходный текст, точечно внеся в него все указанные в примечаниях изменения. Сохраняй структуру, стиль и тон оригинала. Не добавляй пояснений, просто выведи исправленную версию.
""" 
        result = f"""
{base_context}
    
{content_type_instructions}
    
Запрос пользователя: {user_text}
    
Дополнительные требования:
- Отвечай на русском языке
- Будь конкретным и практичным
- Используй структурированный подход
- Предлагай реализуемые решения
- количество слов должно быть близким к оригиналу
"""
        return result
    async def generate_idea_prompt( user_text: str, style: str, nko_information: str) -> str:
        # Базовый промпт с учетом стиля и НКО
        base_context = f"Стиль изложения: {style}."
        if nko_information and nko_information != "None":
            base_context += f" Учитывай контекст некоммерческой организации: {nko_information}"
        if any(word in user_text.lower() for word in ['визуал', 'изображен', 'картинк', 'фото', 'граф','оформл']):
            content_type_instructions = """
            Предложи 5-7 креативных идей для визуального контента:
            - Опиши концепцию каждой идеи
            - Укажите возможные стили и цветовые палитры
            - Предложи варианты композиции
            - Добавь рекомендации по реализации
        
            Требования:
            - Идеи должны быть разнообразными и практичными
            - Учитывай современные тренды в дизайне
            - Ориентируйся на целевую аудиторию
            """
        else:
            content_type_instructions = """
            Предложи 7-10 креативных идей по запросу пользователя:
            - Детально опиши каждую идею
            - Укажите возможные форматы реализации
            - Добавь рекомендации по развитию идеи
            - Предложи варианты адаптации под разные каналы
        
            Требования:
            - Идеи должны быть конкретными и реализуемыми
            - Учитывай ресурсы некоммерческой организации
            - Ориентируйся на практическую пользу
            """
        result = f"""
{base_context}
    
{content_type_instructions}
    
Запрос пользователя: {user_text}
    
Дополнительные требования:
- Отвечай на русском языке
- Будь конкретным и практичным
- Используй структурированный подход
- количество слов не более 350
"""    
        return result
    async def generate_content_plan_prompt( user_text: str, style: str, nko_information: str) -> str:
        # Базовый промпт с учетом стиля и НКО
        base_context = f"Стиль изложения: {style}."
        if nko_information and nko_information != "None":
            base_context += f" Учитывай контекст некоммерческой организации: {nko_information}"
        content_type_instructions = """
Составь подробный контент-план со следующей структурой:
- Общая концепция и цели контента
- Темы для 7-14 публикаций с описанием
- Рекомендации по форматам (текст, фото, видео и т.д.)
- Предложения по времени публикации
- Метрики для оценки эффективности
        
Требования:
- План должен быть практичным и реализуемым
- Учитывай сезонность и актуальные тренды
- Включи разнообразие форматов
"""        
        result = f"""
{base_context}
    
{content_type_instructions}
    
Запрос пользователя: {user_text}
    
Дополнительные требования:
- Отвечай на русском языке
- Будь конкретным и практичным
- Используй структурированный подход
- количество слов не более 350
"""    
        return result